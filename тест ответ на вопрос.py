import random
import asyncio
from aiogram import Bot, Dispatcher, types
from aiogram.types import InlineKeyboardButton, InlineKeyboardMarkup

API_TOKEN = "8492691594:AAHGomYK8lOc-AUGzJ-PtHGopAixKsPOlI0"

bot = Bot(token=API_TOKEN)
dp = Dispatcher()

# ---------- –í–∏–∫—Ç–æ—Ä–∏–Ω–∞: 30 –≤–æ–ø—Ä–æ—Å–æ–≤ ----------
QUIZ = [
    {"question": "1Ô∏è‚É£ –ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø–∏—Ä–∞–º–∏–¥–∞?", "options": ["–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–π –±–∞–Ω–∫", "–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞", "–û–Ω–ª–∞–π–Ω –∫–æ—à–µ–ª–µ–∫"], "correct": 1},
    {"question": "2Ô∏è‚É£ –ü–æ—á–µ–º—É —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–∏—Ä–∞–º–∏–¥—ã –æ–ø–∞—Å–Ω—ã?", "options": ["–ú–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–µ–Ω—å–≥–∏", "–î–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω—ã–π –¥–æ—Ö–æ–¥", "–≠—Ç–æ –≤–∏–¥ –±–∞–Ω–∫–∞"], "correct": 0},
    {"question": "3Ô∏è‚É£ –ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º —Ö–æ—Ä–æ—à–µ–µ?", "options": ["–ú–Ω–æ–≥–æ –¥–µ–Ω–µ–≥ –±–µ–∑ —É—Å–∏–ª–∏–π", "–ö–æ–º–ø–∞–Ω–∏—è –∫—Ä—É–ø–Ω–∞—è", "–ï—Å—Ç—å –ª–∏—Ü–µ–Ω–∑–∏—è"], "correct": 0},
    {"question": "4Ô∏è‚É£ –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ ¬´–±—ã—Å—Ç—Ä—ã—Ö –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π¬ª?", "options": ["–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å", "–í–ª–æ–∂–∏—Ç—å –¥–µ–Ω—å–≥–∏", "–ü–æ–ø—Ä–æ—Å–∏—Ç—å —Å–∫–∏–¥–∫—É"], "correct": 0},
    {"question": "5Ô∏è‚É£ –ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∏—à–∏–Ω–≥?", "options": ["–ü–æ—Ö–∏—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö", "–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è", "–ü–æ–∫—É–ø–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤"], "correct": 0},
    {"question": "6Ô∏è‚É£ –ß—Ç–æ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏–∑–Ω–∞–∫–æ–º —Ñ–∏—à–∏–Ω–≥–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞?", "options": ["–û—à–∏–±–∫–∏ –≤ –∞–¥—Ä–µ—Å–µ", "–ö—Ä–∞—Å–∏–≤—ã–π –¥–∏–∑–∞–π–Ω", "–ú–Ω–æ–≥–æ —Ä–µ–∫–ª–∞–º—ã"], "correct": 0},
    {"question": "7Ô∏è‚É£ –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø—Ä–∏—à–ª–æ –ø–∏—Å—å–º–æ –æ—Ç '–±–∞–Ω–∫–∞' —Å –ø—Ä–æ—Å—å–±–æ–π –≤–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ?", "options": ["–£–¥–∞–ª–∏—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏", "–ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ", "–û—Ç–≤–µ—Ç–∏—Ç—å –ø–∏—Å—å–º–æ–º"], "correct": 0},
    {"question": "8Ô∏è‚É£ –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –ø–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–º —Å—Å—ã–ª–∫–∞–º?", "options": ["–ú–æ–≥—É—Ç —É–∫—Ä–∞—Å—Ç—å –¥–∞–Ω–Ω—ã–µ", "–ù–µ —Ä–∞–±–æ—Ç–∞—é—Ç", "–î–æ–ª–≥–æ –≥—Ä—É–∑—è—Ç—Å—è"], "correct": 0},
    {"question": "9Ô∏è‚É£ –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Ç—ã –≤–≤—ë–ª –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ñ–∏—à–∏–Ω–≥–æ–≤–æ–º —Å–∞–π—Ç–µ?", "options": ["–°—Ä–∞–∑—É –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É", "–ñ–¥–∞—Ç—å", "–£–¥–∞–ª–∏—Ç—å —Å–∞–π—Ç"], "correct": 0},
    {"question": "üîü –ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å?", "options": ["–ó–∞—â–∏—Ç–∞ –¥–µ–Ω–µ–≥ –∏ –¥–∞–Ω–Ω—ã—Ö", "–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–µ–Ω–µ–≥ –¥–æ–º–∞", "–ü–æ–∫—É–ø–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞"], "correct": 0},
    {"question": "1Ô∏è‚É£1Ô∏è‚É£ –ü–æ—á–µ–º—É –≤–∞–∂–Ω—ã —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏?", "options": ["–¢—Ä—É–¥–Ω–µ–µ –≤–∑–ª–æ–º–∞—Ç—å", "–ö—Ä–∞—Å–∏–≤–æ —Å–º–æ—Ç—Ä—è—Ç—Å—è", "–õ–µ–≥–∫–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å"], "correct": 0},
    {"question": "1Ô∏è‚É£2Ô∏è‚É£ –ß—Ç–æ –¥–∞–µ—Ç –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è?", "options": ["–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É", "–ù–∏—á–µ–≥–æ", "–£—Å–∫–æ—Ä—è–µ—Ç –≤—Ö–æ–¥"], "correct": 0},
    {"question": "1Ô∏è‚É£3Ô∏è‚É£ –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã?", "options": ["–ú–æ–≥—É—Ç —É–∫—Ä–∞—Å—Ç—å –¥–µ–Ω—å–≥–∏", "–≠—Ç–æ –Ω–µ—É–¥–æ–±–Ω–æ", "–ü–æ—Ä—Ç–∏—Ç—Å—è –∫–∞—Ä—Ç–∞"], "correct": 0},
    {"question": "1Ô∏è‚É£4Ô∏è‚É£ –ü–æ—á–µ–º—É –Ω–µ —Å—Ç–æ–∏—Ç —Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –≤ –∑–∞–º–µ—Ç–∫–∞—Ö?", "options": ["–ò—Ö –º–æ–≥—É—Ç —É–∫—Ä–∞—Å—Ç—å", "–ó–∞–º–µ—Ç–∫–∏ –Ω–µ—É–¥–æ–±–Ω—ã–µ", "–û–Ω–∏ —É–¥–∞–ª—è—é—Ç—Å—è"], "correct": 0},
    {"question": "1Ô∏è‚É£5Ô∏è‚É£ –ö—Ç–æ —Ç–∞–∫–æ–π ¬´–¥—Ä–æ–ø¬ª?", "options": ["–ß–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–¥–∞—ë—Ç –∫–∞—Ä—Ç—É –º–æ—à–µ–Ω–Ω–∏–∫–∞–º", "–ë–∞–Ω–∫–∏—Ä", "–ò–Ω–≤–µ—Å—Ç–æ—Ä"], "correct": 0},
    {"question": "1Ô∏è‚É£6Ô∏è‚É£ –ü–æ—á–µ–º—É –±—ã—Ç—å –¥—Ä–æ–ø–æ–º –æ–ø–∞—Å–Ω–æ?", "options": ["–£–≥–æ–ª–æ–≤–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å", "–ú–Ω–æ–≥–æ —Ä–∞–±–æ—Ç—ã", "–ù–µ—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã"], "correct": 0},
    {"question": "1Ô∏è‚É£7Ô∏è‚É£ –ß—Ç–æ –±—É–¥–µ—Ç –∑–∞ —É—á–∞—Å—Ç–∏–µ –≤ –æ—Ç–º—ã–≤–∞–Ω–∏–∏ –¥–µ–Ω–µ–≥?", "options": ["–¢—é—Ä—å–º–∞ –∏ —à—Ç—Ä–∞—Ñ", "–ù–∏—á–µ–≥–æ", "–ü—Ä–µ–º–∏—è"], "correct": 0},
    {"question": "1Ô∏è‚É£8Ô∏è‚É£ –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø—Ä–æ—Å—è—Ç –æ—Ñ–æ—Ä–º–∏—Ç—å –∫–∞—Ä—Ç—É –Ω–∞ —Å–µ–±—è?", "options": ["–û—Ç–∫–∞–∑–∞—Ç—å—Å—è", "–°–æ–≥–ª–∞—Å–∏—Ç—å—Å—è", "–ü–æ—Å–æ–≤–µ—Ç–æ–≤–∞—Ç—å—Å—è"], "correct": 0},
    {"question": "1Ô∏è‚É£9Ô∏è‚É£ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é?", "options": ["–ß–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç", "–°–ø—Ä–æ—Å–∏—Ç—å –¥—Ä—É–≥–∞", "–ì—É–≥–ª–∏—Ç—å –±—ã—Å—Ç—Ä–æ"], "correct": 0},
    {"question": "2Ô∏è‚É£0Ô∏è‚É£ –ó–∞—á–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π?", "options": ["–ß—Ç–æ–±—ã –Ω–µ –ø–æ–ø–∞—Å—Ç—å –∫ –º–æ—à–µ–Ω–Ω–∏–∫–∞–º", "–î–ª—è –∫—Ä–∞—Å–æ—Ç—ã", "–ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–∫—Ä—ã—Ç—å"], "correct": 0},
    {"question": "2Ô∏è‚É£1Ô∏è‚É£ –ü–æ—á–µ–º—É –æ–ø–∞—Å–Ω—ã –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ —á–∞—Ç—ã?", "options": ["–¢–∞–º –º–Ω–æ–≥–æ –º–æ—à–µ–Ω–Ω–∏–∫–æ–≤", "–¢–∞–º —Å–∫—É—á–Ω–æ", "–¢–∞–º –º–∞–ª–æ –ª—é–¥–µ–π"], "correct": 0},
    {"question": "2Ô∏è‚É£2Ô∏è‚É£ –ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Ç–µ–±—è –ø—ã—Ç–∞—é—Ç—Å—è –æ–±–º–∞–Ω—É—Ç—å?", "options": ["–ü—Ä–æ—Å—è—Ç –¥–µ–Ω—å–≥–∏/–¥–∞–Ω–Ω—ã–µ", "–ì–æ–≤–æ—Ä—è—Ç –º–µ–¥–ª–µ–Ω–Ω–æ", "–ü–∏—à—É—Ç –Ω–æ—á—å—é"], "correct": 0},
    {"question": "2Ô∏è‚É£3Ô∏è‚É£ –ü–æ—á–µ–º—É –º–æ—à–µ–Ω–Ω–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç —á—É–≤—Å—Ç–≤–æ —Å—Ä–æ—á–Ω–æ—Å—Ç–∏?", "options": ["–ß—Ç–æ–±—ã –¥–∞–≤–∏—Ç—å –Ω–∞ –∂–µ—Ä—Ç–≤—É", "–ß—Ç–æ–±—ã –ø–æ–º–æ—á—å", "–ß—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å"], "correct": 0},
    {"question": "2Ô∏è‚É£4Ô∏è‚É£ –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –º–æ—à–µ–Ω–Ω–∏–∫–∏ —É–∂–µ —Å–≤—è–∑–∞–ª–∏—Å—å?", "options": ["–ü—Ä–µ—Ä–≤–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç", "–°–æ–≥–ª–∞—à–∞—Ç—å—Å—è", "–î–∞—Ç—å –∏–º —Å–≤–æ—é –∫–∞—Ä—Ç—É"], "correct": 0},
    {"question": "2Ô∏è‚É£5Ô∏è‚É£ –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–æ –ø–∞—Å–ø–æ—Ä—Ç–∞?", "options": ["–ï–≥–æ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–æ—à–µ–Ω–Ω–∏–∫–∏", "–û–Ω —Ç—è–∂–µ–ª—ã–π", "–ï–≥–æ —Ç—Ä—É–¥–Ω–æ —Å—Ñ–æ—Ç–∫–∞—Ç—å"], "correct": 0},
    {"question": "2Ô∏è‚É£6Ô∏è‚É£ –ö—Ç–æ —Ç–∞–∫–æ–π –ø–æ–¥–¥–µ–ª—å–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –±–∞–Ω–∫–∞?", "options": ["–ú–æ—à–µ–Ω–Ω–∏–∫", "–û—Ö—Ä–∞–Ω–Ω–∏–∫", "–ò–Ω–≤–µ—Å—Ç–æ—Ä"], "correct": 0},
    {"question": "2Ô∏è‚É£7Ô∏è‚É£ –ö–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ–ª—å–∑—è —Å–æ–æ–±—â–∞—Ç—å –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É?", "options": ["–ö–æ–¥—ã –∏ –ø–∞—Ä–æ–ª–∏", "–ò–º—è", "–í–æ–∑—Ä–∞—Å—Ç"], "correct": 0},
    {"question": "2Ô∏è‚É£8Ô∏è‚É£ –ü–æ—á–µ–º—É –Ω–µ–ª—å–∑—è —Å—Ç–∞–≤–∏—Ç—å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ APK —Ñ–∞–π–ª—ã?", "options": ["–í—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã", "–ü–ª–æ—Ö–æ–π –¥–∏–∑–∞–π–Ω", "–ú–Ω–æ–≥–æ —Ä–µ–∫–ª–∞–º—ã"], "correct": 0},
    {"question": "2Ô∏è‚É£9Ô∏è‚É£ –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å —Å–æ—Ü—Å–µ—Ç–∏ –æ—Ç –≤–∑–ª–æ–º–∞?", "options": ["–°–ª–æ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å –∏ 2FA", "–°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É", "–£–¥–∞–ª—è—Ç—å –¥—Ä—É–∑–µ–π"], "correct": 0},
    {"question": "3Ô∏è‚É£0Ô∏è‚É£ –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Å—Ç–∞–ª –∂–µ—Ä—Ç–≤–æ–π –º–æ—à–µ–Ω–Ω–∏–∫–æ–≤?", "options": ["–ü–æ–∑–≤–æ–Ω–∏—Ç—å –≤ –±–∞–Ω–∫ –∏ –ø–æ–ª–∏—Ü–∏—é", "–ù–∏—á–µ–≥–æ", "–°–∫—Ä—ã–≤–∞—Ç—å"], "correct": 0}
]

user_quiz_state = {}

# ---------- –§—É–Ω–∫—Ü–∏–∏ ----------
def quiz_buttons(options: list):
    buttons = []
    shuffled = list(enumerate(options))
    random.shuffle(shuffled)
    for idx, text in shuffled:
        buttons.append([InlineKeyboardButton(text=text, callback_data=f"answer_{idx}")])
    return InlineKeyboardMarkup(inline_keyboard=buttons)

def start_quiz_inline():
    return InlineKeyboardMarkup(
        inline_keyboard=[[InlineKeyboardButton(text="‚ñ∂Ô∏è –°—Ç–∞—Ä—Ç –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã", callback_data="quiz")]]
    )

def main_menu_inline():
    return InlineKeyboardMarkup(
        inline_keyboard=[[InlineKeyboardButton(text="üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="menu")]]
    )

async def send_question(user_id: int, chat_id: int, idx: int):
    state = user_quiz_state[user_id]

    if state["last_msg_id"]:
        try:
            await bot.delete_message(chat_id, state["last_msg_id"])
        except:
            pass

    if idx >= len(QUIZ):
        score = state["score"]
        total = len(QUIZ)
        del user_quiz_state[user_id]
        await bot.send_message(
            chat_id,
            f"üéâ –í–∏–∫—Ç–æ—Ä–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n–¢–≤–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: *{score} / {total}* –±–∞–ª–ª–æ–≤.",
            parse_mode="Markdown",
            reply_markup=main_menu_inline()
        )
        return

    q = QUIZ[idx]
    msg = await bot.send_message(chat_id, q["question"], reply_markup=quiz_buttons(q["options"]))
    state["last_msg_id"] = msg.message_id
    state["index"] = idx

# ---------- –•—ç–Ω–¥–ª–µ—Ä—ã ----------
@dp.message()
async def start_message(message: types.Message):
    if message.text == "/start":
        await message.answer("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∏–∫—Ç–æ—Ä–∏–Ω—É! –ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.", reply_markup=start_quiz_inline())

@dp.callback_query()
async def callback_handler(callback: types.CallbackQuery):
    user_id = callback.from_user.id
    chat_id = callback.message.chat.id
    data = callback.data

    if data == "quiz":
        user_quiz_state[user_id] = {"index": 0, "score": 0, "last_msg_id": None}
        await send_question(user_id, chat_id, 0)

    elif data.startswith("answer_"):
        state = user_quiz_state[user_id]
        selected = int(data.split("_")[1])
        correct = QUIZ[state["index"]]["correct"]

        if selected == correct:
            state["score"] += 1
            await callback.answer("‚úî –ü—Ä–∞–≤–∏–ª—å–Ω–æ!", show_alert=False)
        else:
            await callback.answer("‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ", show_alert=False)

        await send_question(user_id, chat_id, state["index"] + 1)

# ---------- –ó–∞–ø—É—Å–∫ ----------
async def main():
    await dp.start_polling(bot)

if __name__ == "__main__":
    asyncio.run(main())
